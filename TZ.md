# Техническое задание (ТЗ)
## Учебный проект: «Криптовалютная спотовая биржа (симулятор)»

**Версия:** 1.0  
  
  

---

## 1. Введение
### 1.1. Цель проекта
Разработать веб‑приложение, имитирующее работу криптовалютной **спотовой биржи** в **учебном режиме** (без реальных денег и без блокчейн‑транзакций). Пользователь должен иметь возможность пополнять виртуальный баланс, выставлять заявки (ордера), видеть стакан, получать сделки и историю.

### 1.2. Границы проекта
Проект является симулятором:
- **Нет** реальных пополнений/выводов через блокчейн.
- **Нет** KYC/AML (можно добавить как заглушку).
- Все балансы — виртуальные и хранятся в базе данных.

### 1.3. Основные сущности
Пользователь, Балансы, Рынок (торговая пара), Ордер, Сделка (Trade), Операции кошелька.

---

## 2. Термины и определения
- **Спот (Spot):** торговля активом «сейчас», без плеча.
- **Торговая пара:** например BTC/USDT (base/quote).
- **Ордер:** заявка на покупку/продажу (Limit/Market).
- **Стакан (Order Book):** список заявок на покупку (bids) и продажу (asks).
- **Matching engine:** модуль сопоставления заявок (price‑time priority).
- **available/reserved:** доступный баланс и зарезервированный под ордера.

---

## 3. Роли и права доступа
### 3.1. Гость
- Просмотр списка рынков.
- Просмотр стакана и последних сделок по рынку.

### 3.2. Пользователь
- Регистрация/авторизация.
- Просмотр и управление кошельком (виртуальные балансы).
- Выставление/отмена ордеров.
- Просмотр своих ордеров и сделок.

### 3.3. Администратор
- Управление рынками (вкл/выкл, комиссия).
- Управление пользователями (блокировка).
- Просмотр сделок/логов.
- Управление «тестовыми депозитами».

---

## 4. Функциональные требования (MVP)

### 4.1. Регистрация и авторизация
**Функции:**
- Регистрация пользователя по email и паролю.
- Авторизация (логин/логаут).
- Получение данных текущего пользователя.

**Требования к безопасности:**
- Пароль хранить только в виде хеша (bcrypt/argon2).
- Сессия/JWT с ограниченным временем жизни.

**Критерии приёмки:**
- Пользователь может зарегистрироваться и войти.
- Некорректные данные возвращают понятную ошибку.

### 4.2. Кошелёк (виртуальные балансы)
**Функции:**
- Просмотр баланса по валютам (например: USDT, BTC, ETH).
- Баланс должен быть разделён на:
  - `available` — доступно
  - `reserved` — зарезервировано под ордера
- Тестовое пополнение баланса (endpoint или кнопка) — только для симуляции.
- История операций кошелька.

**Критерии приёмки:**
- После пополнения увеличивается `available`.
- При выставлении лимит‑ордера часть баланса уходит в `reserved`.
- При отмене ордера резерв возвращается.

### 4.3. Рынки и торговые пары
**Функции:**
- Список рынков (минимум 2): BTC/USDT и ETH/USDT.
- Статус рынка: ACTIVE/INACTIVE.
- Комиссия рынка (feeRate).

**Критерии приёмки:**
- Неактивный рынок не принимает новые ордера.

### 4.4. Ордеры
Поддерживаемые типы:
- **Limit Order** (buy/sell, price, amount)
- **Market Order** (buy/sell, amount)

Поддерживаемые статусы:
- `NEW`, `PARTIALLY_FILLED`, `FILLED`, `CANCELLED`, `REJECTED`

Правила резервирования:
- **BUY limit**: резервировать в quote (USDT) сумму `price * amount + fee`.
- **SELL limit**: резервировать в base (BTC/ETH) сумму `amount`.

**Критерии приёмки:**
- Ордер создаётся только при достаточном `available`.
- Market‑ордер исполняется об лучшие встречные заявки.
- Частичное исполнение корректно обновляет `filled` и статус.

### 4.5. Matching engine
**Алгоритм:** price‑time priority.
- Для BUY исполняем об лучшие asks (минимальная цена).
- Для SELL исполняем об лучшие bids (максимальная цена).
- При равной цене приоритет у более раннего ордера.

**Критерии приёмки:**
- На одном и том же наборе заявок результат детерминирован.
- Частичные исполнения не ломают баланс.

### 4.6. Сделки (Trades)
**Функции:**
- При каждом матчинге создаётся запись сделки.
- Сделка хранит: символ, цену, объём, maker/taker (опционально), время.

### 4.7. История
**Функции:**
- История ордеров пользователя (фильтры по статусу/символу/периоду).
- История сделок пользователя.
- Публичная лента последних сделок по рынку.

---

## 5. API (требования к интерфейсам)
Набор минимальных REST‑эндпоинтов (пример):

### 5.1. Auth
- `POST /api/auth/register`
- `POST /api/auth/login`
- `POST /api/auth/logout`
- `GET /api/me`

### 5.2. Wallet
- `GET /api/wallet/balances`
- `POST /api/wallet/deposit` (тестовый)
- `GET /api/wallet/tx`

### 5.3. Markets
- `GET /api/markets`
- `GET /api/markets/{symbol}`
- `GET /api/markets/{symbol}/orderbook`
- `GET /api/markets/{symbol}/trades`

### 5.4. Orders
- `POST /api/orders`
- `DELETE /api/orders/{id}`
- `GET /api/orders`

---

## 6. Нефункциональные требования
- **Надёжность:** операции баланса/ордера/сделки должны быть в транзакции БД.
- **Логи:** журнал ошибок + аудит действий пользователя (создал/отменил ордер).
- **Производительность:** для MVP достаточно корректности; оптимизация — отдельный этап.
- **Тестирование:** unit‑тесты для matching engine (минимум).

---

## 7. Ограничения и допущения
- Виртуальные депозиты/выводы без блокчейна.
- Нет маржинальной торговли и плеча.
- Комиссия фиксированная (в MVP), maker/taker — опционально.

---

## 8. Этапы реализации (план на 7 месяцев)
### Этап 1 (MVP, 1–2 месяца)
Auth, Wallet, Limit orders, Matching, Trades, History.

### Этап 2 (1–2 месяца)
Market orders, комиссии, свечи (OHLC 1m).

### Этап 3 (1–2 месяца)
WebSocket (стакан/сделки/тикер), оптимизации.

### Этап 4 (1 месяц)
Админка, безопасность (rate limit), тесты/аудит.

### Этап 5 (2–4 недели)
Документация, Docker, демонстрационный сценарий, финальная полировка.

---

## 9. Критерии готовности дипломного проекта
- Можно зарегистрироваться, пополнить тестовый баланс, выставить ордер и получить сделку.
- Балансы корректно учитывают reserved/available.
- История ордеров/сделок/кошелька отображается.
- Есть документация по запуску и краткое описание архитектуры.
